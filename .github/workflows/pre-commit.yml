name: ğŸ§ª Pre-commit Tests

on:
  pull_request:
    branches: [ main, develop ]
  push:
    branches: [ develop ]

env:
  PYTHON_VERSION: '3.11'

jobs:
  quick-tests:
    name: ğŸš€ Testes RÃ¡pidos
    runs-on: windows-latest
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
      
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        cache: 'pip'
        
    - name: ğŸ“¦ Install dependencies
      run: |
        pip install -r requirements.txt
        pip install pytest pytest-cov black flake8
        
    - name: ğŸ¨ Check formatting
      run: black --check .
      
    - name: ğŸ” Lint code
      run: flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
      
    - name: ğŸ§ª Run quick tests
      run: pytest tests/test_simple.py -v
      
    - name: âœ… Validation passed
      run: echo "âœ… CÃ³digo pronto para commit!"

  accessibility-check:
    name: â™¿ VerificaÃ§Ã£o de Acessibilidade
    runs-on: windows-latest
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
      
    - name: ğŸ¨ Verificar contraste de cores
      run: |
        echo "ğŸ¨ Verificando padrÃµes de acessibilidade..."
        
        # Verificar se cores seguem padrÃµes WCAG
        $code = Get-Content -Path "gerar_od_gui.py" -Raw
        
        # Cores que devem estar presentes (WCAG compliant)
        $required_colors = @(
          "#007bff",  # Primary blue
          "#28a745",  # Success green  
          "#dc3545",  # Error red
          "#f8f9fa",  # Background light
          "#212529"   # Text dark
        )
        
        $missing_colors = @()
        foreach ($color in $required_colors) {
          if ($code -notmatch [regex]::Escape($color)) {
            $missing_colors += $color
          }
        }
        
        if ($missing_colors.Count -gt 0) {
          Write-Host "âš ï¸ Cores de acessibilidade ausentes: $($missing_colors -join ', ')"
        } else {
          Write-Host "âœ… Cores de acessibilidade presentes"
        }
        
    - name: ğŸ“± Verificar responsividade
      run: |
        echo "ğŸ“± Verificando padrÃµes de responsividade..."
        
        # Verificar se componentes GUI usam grid apropriado
        $gui_code = Get-Content -Path "gerar_od_gui.py" -Raw
        
        if ($gui_code -match "grid_columnconfigure.*weight") {
          Write-Host "âœ… Grid responsivo configurado"
        } else {
          Write-Host "âš ï¸ Verificar configuraÃ§Ã£o de grid responsivo"
        }
        
        if ($gui_code -match "sticky.*nsew|sticky.*ew") {
          Write-Host "âœ… Componentes com expansÃ£o configurada"
        } else {
          Write-Host "âš ï¸ Verificar expansÃ£o de componentes"
        }
